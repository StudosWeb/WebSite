<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <title>Home - Estudos</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="btns-fixed-top">
        <button type="button"><i class="bi bi-bell-fill"></i></button>
    </div>

    <nav class="menu-lateral">
        <ul>
            <li class="item-menu ativo">
                <a href="./home.html" class="active">
                    <span class="icon"><i class="bi bi-house-door"></i></span>
                    <span class="txt-link">Home</span>
                </a>
            </li>
            <li class="item-menu">
                <a href="materias.html">
                    <span class="icon"><i class="bi bi-columns-gap"></i></span>
                    <span class="txt-link">Matérias</span>
                </a>
            </li>
            <li class="item-menu">
                <a href="canais.html">
                    <span class="icon"><i class="bi bi-chat-right-text"></i></span>
                    <span class="txt-link">Canais</span>
                </a>
            </li>
            <li class="item-menu">
                <a href="request.html">
                    <span class="icon"><i class="bi bi-briefcase"></i></span>
                    <span class="txt-link">Solicitar</span>
                </a>
            </li>
            <li class="item-menu">
                <a href="./profile/">
                    <span class="icon"><i class="bi bi-person-circle"></i></span>
                    <span class="txt-link">Conta</span>
                </a>
            </li>
        </ul>
    </nav>

    <div class="btns-fixed">
        <button type="button" id="representente" onclick="alert('Ops.. Não encontramos essa função.')" style="display: none;"><i class="bi bi-clipboard2-plus"></i></button>
        <button type="button" id="addResumer" onclick="addSumery()" style="display: none;"><i class="bi bi-plus"></i></button>
       </div>

    <section>
        <h1>Home</h1>
    </section>

    <!-- Carregue o Firebase e a Configuração -->
    <script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-firestore-compat.js"></script>
    <script src="../../firebaseConfig.js"></script>
    <script src="../js/auth-guard.js"></script>

    <!-- Modal de Carregamento -->
 <div id="loading-modal" class="loading-modal hide">
    <div class="loading-content">
        <div class="spinner"></div>
    </div>
</div>

    <script>
        function showLoadingModal() {
    const loadingModal = document.getElementById('loading-modal');
    loadingModal.classList.remove('hide');
}

function hideLoadingModal() {
    const loadingModal = document.getElementById('loading-modal');
    loadingModal.classList.add('hide');
}

        // Hover e click menu
        const menuItem = document.querySelectorAll('.item-menu');

        function selectLink() {
            menuItem.forEach(item => item.classList.remove('ativo'));
            this.classList.add('ativo');
        }

        menuItem.forEach(item => item.addEventListener('click', selectLink));

        // Expandir menu
        const btnExp = document.querySelector('#btn-exp');
        const menuSide = document.querySelector('.menu-lateral');

        if (btnExp) {
            btnExp.addEventListener('click', function() {
                menuSide.classList.toggle('expandir');
            });
        }

        const auth = firebase.auth();
        const db = firebase.firestore();

        // Função para verificar o campo resummer no Firestore
        function checkResummer() {
            auth.onAuthStateChanged(user => {
                if (user) {
                    const userRef = db.collection('users').doc(user.uid);
                    userRef.get().then(doc => {
                        if (doc.exists) {
                            const resummer = doc.data().resummer;
                            const addResumerBtn = document.getElementById('addResumer');
                            if (resummer) {
                                addResumerBtn.style.display = 'block';
                            } else {
                                addResumerBtn.style.display = 'none';
                            }
                        } else {
                            console.log('Documento do usuário não encontrado');
                        }
                    }).catch(error => {
                        console.error('Erro ao recuperar documento:', error);
                    });
                } else {
                    console.log('Usuário não autenticado');
                }
            });
        }

        // Função para verificar o campo resummer no Firestore
        function checkRepresent() {
            auth.onAuthStateChanged(user => {
                if (user) {
                    const userRef = db.collection('users').doc(user.uid);
                    userRef.get().then(doc => {
                        if (doc.exists) {
                            const represent = doc.data().representante;
                            const addRepresentBtn = document.getElementById('representente');
                            if (represent) {
                                addRepresentBtn.style.display = 'block';
                            } else {
                                addRepresentBtn.style.display = 'none';
                            }
                        } else {
                            console.log('Documento do usuário não encontrado');
                        }
                    }).catch(error => {
                        console.error('Erro ao recuperar documento:', error);
                    });
                } else {
                    console.log('Usuário não autenticado');
                }
            });
        }

        // Chamar a função para verificar o campo resummer
        checkResummer();
        checkRepresent();

        function addSumery() {
            showLoadingModal()
            setTimeout(() => {
                hideLoadingModal()
                window.location.href = 'addSummary.html';
            }, 2000)
        }

        function representPage() {
            showLoadingModal()
            setTimeout(() => {
                hideLoadingModal()
                window.location.href = './rep/'
            }, 2000);
        }
    </script>
</body>
</html>
